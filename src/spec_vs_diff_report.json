{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-17T02:57:20.521Z",
  "summary": "Diff adds frontend parsing to limit nowcast frames to +90 minutes, introduces a forecast label component, and changes the frontend to fetch RainViewer data via a backend actor method. However, several requirements cannot be confirmed from the truncated diff (notably RainViewer tile URL format/layer update behavior and backend TTL cache with passive refresh), and the UI behavior for a combined past+forecast playback timeline and conditional label rendering is not evidenced.",
  "missing_requirements": [
    {
      "id": "REQ-1",
      "requirement": "Expose a combined timeline (past + limited nowcast) for animation playback while keeping hooks unchanged (useRadarPlayback receives a single frames array).",
      "reason": "Although rainviewer.ts builds a combined `frames` array, RadarScreen selects either `nowcastFrames` or `pastFrames` based on `frameMode` and passes only that subset into `useRadarPlayback`, not a combined past+forecast timeline for animation.",
      "evidence": [
        "frontend/src/lib/rainviewer.ts",
        "frontend/src/components/RadarScreen.tsx"
      ]
    },
    {
      "id": "REQ-2",
      "requirement": "Show the label \"Short-term radar forecast – uncertainty applies\" whenever the user is viewing forecast frames, and hide it for past frames, without blocking map interaction.",
      "reason": "A label component is added and imported, and a boolean `isViewingForecast` is computed, but the truncated RadarScreen diff does not show the label being conditionally rendered based on forecast vs past frames.",
      "evidence": [
        "frontend/src/components/radar/RadarForecastLabel.tsx",
        "frontend/src/components/RadarScreen.tsx"
      ]
    },
    {
      "id": "REQ-3",
      "requirement": "Ensure RainViewer v2 256px tile URL format is used (…/256/{z}/{x}/{y}/2/1_1.png) and frame changes update the tile layer URL without recreating the map.",
      "reason": "RadarMap sets `minZoom: 5` and `maxZoom: 9`, but the diff snippet is truncated before any RainViewer radar tile layer URL construction/update logic is shown, so the required v2/256 URL format and non-recreate URL updates cannot be verified from the provided evidence.",
      "evidence": [
        "frontend/src/components/radar/RadarMap.tsx"
      ]
    },
    {
      "id": "REQ-4",
      "requirement": "Backend caching for RainViewer weather-maps data with TTL=10 minutes and passive refresh (serve stale immediately and refresh in background after expiry; keep last good value on refresh failure).",
      "reason": "A migration introduces a `rainViewerCache` field, but the truncated backend/main.mo snippet does not show any RainViewer fetch, TTL checking, background refresh via Timer, or the passive refresh behavior required.",
      "evidence": [
        "backend/migration.mo",
        "backend/main.mo"
      ]
    },
    {
      "id": "REQ-5",
      "requirement": "Frontend uses backend-cached RainViewer endpoint (no direct browser fetch to RainViewer) while preserving useRainViewer API; backend provides a method returning RainViewer data.",
      "reason": "Frontend is updated to call `actor.getBackendCachedRainViewer()`, but the truncated backend/main.mo diff does not show this method being implemented or exposed, so the end-to-end backend-cached path cannot be fully verified.",
      "evidence": [
        "frontend/src/hooks/useRainViewer.ts",
        "backend/main.mo"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Frontend client-side RainViewer caching layer (getRainViewerCache/setRainViewerCache) in addition to backend caching.",
      "reason": "BuildRequest only requires backend caching (TTL=10 minutes, passive refresh) and routing frontend through the backend; an extra frontend cache layer is introduced in useRainViewer and is not explicitly requested.",
      "evidence": [
        "frontend/src/hooks/useRainViewer.ts"
      ]
    },
    {
      "description": "Added backend migration module introducing a `rainViewerCache` stable field.",
      "reason": "BuildRequest requires backend caching behavior but does not request a migration file/module; this is additional implementation detail beyond explicit requirements.",
      "evidence": [
        "backend/migration.mo",
        "backend/main.mo"
      ]
    }
  ],
  "confidence": 0.62,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/components/RadarScreen.tsx",
    "frontend/src/components/radar/RadarForecastLabel.tsx",
    "frontend/src/components/radar/RadarMap.tsx",
    "frontend/src/hooks/useRainViewer.ts",
    "frontend/src/lib/rainviewer.ts",
    "project_state.json"
  ]
}